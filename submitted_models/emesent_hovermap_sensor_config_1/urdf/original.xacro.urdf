<?xml version="1.0" ?>
<!-- =================================================================================== -->
<!-- |    This document was autogenerated by xacro from urdf/navi_ardupilot.xacro      | -->
<!-- |    EDITING THIS FILE BY HAND IS NOT RECOMMENDED                                 | -->
<!-- =================================================================================== -->
<!--
  Copyright 2015 Fadri Furrer, ASL, ETH Zurich, Switzerland
  Copyright 2015 Michael Burri, ASL, ETH Zurich, Switzerland
  Copyright 2015 Mina Kamel, ASL, ETH Zurich, Switzerland
  Copyright 2015 Janosch Nikolic, ASL, ETH Zurich, Switzerland
  Copyright 2015 Markus Achtelik, ASL, ETH Zurich, Switzerland

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<robot name="emesent_hovermap_sensor_config_1" xmlns:xacro="http://ros.org/wiki/xacro">
  <!-- Included URDF Files -->
  <!--xacro:include
		filename="$(find rotors_description)/urdf/multirotor_base.xacro" /-->
  <link name="base_link"/>
  <joint name="base_joint" type="fixed">
    <origin rpy="0 0 1.57079632679" xyz="0 0 0"/>
    <parent link="base_link"/>
    <child link="body"/>
  </joint>
  <link name="body">
    <inertial>
      <mass value="4.57"/>
      <!-- [kg] -->
      <origin xyz="-0.0 0.0185 -0.05"/>
      <!-- xyz="-0.0 0.13 0.0" or xyz="0.00 0.13 -0.1" -->
      <inertia ixx="0.1052111083" ixy="0.0" ixz="0.0" iyy="0.1052111083" iyz="0.0" izz="0.12542375"/>
      <!-- [kg m^2] [kg m^2] [kg m^2] [kg m^2] [kg m^2] [kg m^2] -->
    </inertial>
    <visual>
      <origin rpy="0 0 0" xyz="0.0 -0.11 0"/>
      <geometry>
        <mesh filename="package://hovermap_subt/meshes/navi-drone-hipoly-mount.dae" scale="1 1 1"/>
      </geometry>
    </visual>
    <!-- visual and collision for the prop guard are seperate from the main body -->
    <visual>
      <origin rpy="0 0 0" xyz="0.0 -0.11 0"/>
      <geometry>
        <mesh filename="package://hovermap_subt/meshes/navi-guard.dae" scale="1 1 1"/>
      </geometry>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0.0 -0.11 0"/>
      <geometry>
        <mesh filename="package://hovermap_subt/meshes/navi-drone-hipoly-mount.dae" scale="1 1 1"/>
      </geometry>
    </collision>
    <collision>
      <origin rpy="0 0 0" xyz="0.0 -0.11 0"/>
      <geometry>
        <mesh filename="package://hovermap_subt/meshes/navi-guard.dae" scale="1 1 1"/>
      </geometry>
    </collision>
  </link>
  <link name="rotor_0">
    <inertial>
      <mass value="0.02"/>
      <origin rpy="0. 0. 1.57079632679" xyz="0. 0. 0."/>
      <inertia ixx="2.326665736e-06" ixy="0.0" ixz="0.0" iyy="6.03333092e-05" iyz="0.0" izz="6.2326641736e-05"/>
    </inertial>
    <collision name="rotor_0_collision">
      <geometry>
        <box size="0.38 0.036 0.01"/>
      </geometry>
      <origin rpy="0. 0. 1.01341698503" xyz="0. 0. 0.04"/>
    </collision>
    <collision name="rotor_0_collision">
      <geometry>
        <box size="0.35492 0.036 0.01"/>
      </geometry>
      <origin rpy="0. 0. -0.604152433383" xyz="0. 0. -0.0375"/>
    </collision>
    <!-- top rotor (15in)-->
    <visual name="rotor_0_visual">
      <geometry>
        <mesh filename="package://hovermap_subt/meshes/navi-15in-CW-tex.dae" scale="1 1 1"/>
        <origin rpy="0. 0. 0." xyz="-1. 0. 0."/>
      </geometry>
    </visual>
    <!-- bottom rotor (14in)-->
    <visual name="rotor_0_visual">
      <geometry>
        <mesh filename="package://hovermap_subt/meshes/navi-14in-CW-tex.dae" scale="1 1 1"/>
        <origin rpy="0. 0. 0" xyz="-1. 0. 0."/>
      </geometry>
    </visual>
  </link>
  <joint name="rotor_0_joint" type="continuous">
    <origin rpy="0 0 0" xyz="0.24 -0.24 0.035"/>
    <child link="rotor_0"/>
    <parent link="base_link"/>
    <axis xyz="0 0 1"/>
    <gazebo>
      <physics>
        <ode>
          <implicit_spring_damper>1</implicit_spring_damper>
        </ode>
      </physics>
    </gazebo>
  </joint>
  <gazebo>
    <plugin filename="libLiftDragPlugin.so" name="rotor_0_blade_1">
      <a0>0.3</a0>
      <alpha_stall>1.4</alpha_stall>
      <cla>0.06</cla>
      <cda>0.10</cda>
      <cma>0.00</cma>
      <cla_stall>-0.025</cla_stall>
      <cda_stall>0.0</cda_stall>
      <cma_stall>0.0</cma_stall>
      <area>0.02345</area>
      <air_density>1.2041</air_density>
      <cp>0.084 0 0</cp>
      <forward>0 1 0</forward>
      <upward>0 0 1</upward>
      <link_name>rotor_0</link_name>
    </plugin>
    <plugin filename="libLiftDragPlugin.so" name="rotor_0_blade_2">
      <a0>0.3</a0>
      <alpha_stall>1.4</alpha_stall>
      <cla>0.06</cla>
      <cda>0.10</cda>
      <cma>0.00</cma>
      <cla_stall>-0.025</cla_stall>
      <cda_stall>0.0</cda_stall>
      <cma_stall>0.0</cma_stall>
      <area>0.02345</area>
      <air_density>1.2041</air_density>
      <cp>-0.084 0 0</cp>
      <forward>0 -1 0</forward>
      <upward>0 0 1</upward>
      <link_name>rotor_0</link_name>
    </plugin>
  </gazebo>
  <link name="rotor_1">
    <inertial>
      <mass value="0.02"/>
      <origin rpy="0. 0. 1.57079632679" xyz="0. 0. 0."/>
      <inertia ixx="2.326665736e-06" ixy="0.0" ixz="0.0" iyy="6.03333092e-05" iyz="0.0" izz="6.2326641736e-05"/>
    </inertial>
    <collision name="rotor_1_collision">
      <geometry>
        <box size="0.38 0.036 0.01"/>
      </geometry>
      <origin rpy="0. 0. 1.01341698503" xyz="0. 0. 0.04"/>
    </collision>
    <collision name="rotor_1_collision">
      <geometry>
        <box size="0.35492 0.036 0.01"/>
      </geometry>
      <origin rpy="0. 0. -0.604152433383" xyz="0. 0. -0.0375"/>
    </collision>
    <!-- top rotor (15in)-->
    <visual name="rotor_1_visual">
      <geometry>
        <mesh filename="package://hovermap_subt/meshes/navi-15in-CW-tex.dae" scale="1 1 1"/>
        <origin rpy="0. 0. 0." xyz="-1. 0. 0."/>
      </geometry>
    </visual>
    <!-- bottom rotor (14in)-->
    <visual name="rotor_1_visual">
      <geometry>
        <mesh filename="package://hovermap_subt/meshes/navi-14in-CW-tex.dae" scale="1 1 1"/>
        <origin rpy="0. 0. 0" xyz="-1. 0. 0."/>
      </geometry>
    </visual>
  </link>
  <joint name="rotor_1_joint" type="continuous">
    <origin rpy="0 0 0" xyz="-0.24 0.24 0.035"/>
    <child link="rotor_1"/>
    <parent link="base_link"/>
    <axis xyz="0 0 1"/>
    <gazebo>
      <physics>
        <ode>
          <implicit_spring_damper>1</implicit_spring_damper>
        </ode>
      </physics>
    </gazebo>
  </joint>
  <gazebo>
    <plugin filename="libLiftDragPlugin.so" name="rotor_1_blade_1">
      <a0>0.3</a0>
      <alpha_stall>1.4</alpha_stall>
      <cla>0.06</cla>
      <cda>0.10</cda>
      <cma>0.00</cma>
      <cla_stall>-0.025</cla_stall>
      <cda_stall>0.0</cda_stall>
      <cma_stall>0.0</cma_stall>
      <area>0.02345</area>
      <air_density>1.2041</air_density>
      <cp>0.084 0 0</cp>
      <forward>0 1 0</forward>
      <upward>0 0 1</upward>
      <link_name>rotor_1</link_name>
    </plugin>
    <plugin filename="libLiftDragPlugin.so" name="rotor_1_blade_2">
      <a0>0.3</a0>
      <alpha_stall>1.4</alpha_stall>
      <cla>0.06</cla>
      <cda>0.10</cda>
      <cma>0.00</cma>
      <cla_stall>-0.025</cla_stall>
      <cda_stall>0.0</cda_stall>
      <cma_stall>0.0</cma_stall>
      <area>0.02345</area>
      <air_density>1.2041</air_density>
      <cp>-0.084 0 0</cp>
      <forward>0 -1 0</forward>
      <upward>0 0 1</upward>
      <link_name>rotor_1</link_name>
    </plugin>
  </gazebo>
  <link name="rotor_2">
    <inertial>
      <mass value="0.02"/>
      <origin rpy="0. 0. 1.57079632679" xyz="0. 0. 0."/>
      <inertia ixx="2.326665736e-06" ixy="0.0" ixz="0.0" iyy="6.03333092e-05" iyz="0.0" izz="6.2326641736e-05"/>
    </inertial>
    <collision name="rotor_2_collision">
      <geometry>
        <box size="0.38 0.036 0.01"/>
      </geometry>
      <origin rpy="0. 0. -1.01341698503" xyz="0. 0. 0.04"/>
    </collision>
    <collision name="rotor_2_collision">
      <geometry>
        <box size="0.35492 0.036 0.01"/>
      </geometry>
      <origin rpy="0. 0. 0.604152433383" xyz="0. 0. -0.0375"/>
    </collision>
    <!-- top rotor (15in)-->
    <visual name="rotor_2_visual">
      <geometry>
        <mesh filename="package://hovermap_subt/meshes/navi-15in-CCW-tex.dae" scale="1 1 1"/>
        <origin rpy="0. 0. 0." xyz="-1. 0. 0."/>
      </geometry>
    </visual>
    <!-- bottom rotor (14in)-->
    <visual name="rotor_2_visual">
      <geometry>
        <mesh filename="package://hovermap_subt/meshes/navi-14in-CCW-tex.dae" scale="1 1 1"/>
        <origin rpy="0. 0. 0" xyz="-1. 0. 0."/>
      </geometry>
    </visual>
  </link>
  <joint name="rotor_2_joint" type="continuous">
    <origin rpy="0 0 0" xyz="0.24 0.24 0.035"/>
    <child link="rotor_2"/>
    <parent link="base_link"/>
    <axis xyz="0 0 1"/>
    <gazebo>
      <physics>
        <ode>
          <implicit_spring_damper>1</implicit_spring_damper>
        </ode>
      </physics>
    </gazebo>
  </joint>
  <gazebo>
    <plugin filename="libLiftDragPlugin.so" name="rotor_2_blade_1">
      <a0>0.3</a0>
      <alpha_stall>1.4</alpha_stall>
      <cla>0.06</cla>
      <cda>0.10</cda>
      <cma>0.00</cma>
      <cla_stall>-0.025</cla_stall>
      <cda_stall>0.0</cda_stall>
      <cma_stall>0.0</cma_stall>
      <area>0.02345</area>
      <air_density>1.2041</air_density>
      <cp>0.084 0 0</cp>
      <forward>0 -1 0</forward>
      <upward>0 0 1</upward>
      <link_name>rotor_2</link_name>
    </plugin>
    <plugin filename="libLiftDragPlugin.so" name="rotor_2_blade_2">
      <a0>0.3</a0>
      <alpha_stall>1.4</alpha_stall>
      <cla>0.06</cla>
      <cda>0.10</cda>
      <cma>0.00</cma>
      <cla_stall>-0.025</cla_stall>
      <cda_stall>0.0</cda_stall>
      <cma_stall>0.0</cma_stall>
      <area>0.02345</area>
      <air_density>1.2041</air_density>
      <cp>-0.084 0 0</cp>
      <forward>0 1 0</forward>
      <upward>0 0 1</upward>
      <link_name>rotor_2</link_name>
    </plugin>
  </gazebo>
  <link name="rotor_3">
    <inertial>
      <mass value="0.02"/>
      <origin rpy="0. 0. 1.57079632679" xyz="0. 0. 0."/>
      <inertia ixx="2.326665736e-06" ixy="0.0" ixz="0.0" iyy="6.03333092e-05" iyz="0.0" izz="6.2326641736e-05"/>
    </inertial>
    <collision name="rotor_3_collision">
      <geometry>
        <box size="0.38 0.036 0.01"/>
      </geometry>
      <origin rpy="0. 0. -1.01341698503" xyz="0. 0. 0.04"/>
    </collision>
    <collision name="rotor_3_collision">
      <geometry>
        <box size="0.35492 0.036 0.01"/>
      </geometry>
      <origin rpy="0. 0. 0.604152433383" xyz="0. 0. -0.0375"/>
    </collision>
    <!-- top rotor (15in)-->
    <visual name="rotor_3_visual">
      <geometry>
        <mesh filename="package://hovermap_subt/meshes/navi-15in-CCW-tex.dae" scale="1 1 1"/>
        <origin rpy="0. 0. 0." xyz="-1. 0. 0."/>
      </geometry>
    </visual>
    <!-- bottom rotor (14in)-->
    <visual name="rotor_3_visual">
      <geometry>
        <mesh filename="package://hovermap_subt/meshes/navi-14in-CCW-tex.dae" scale="1 1 1"/>
        <origin rpy="0. 0. 0" xyz="-1. 0. 0."/>
      </geometry>
    </visual>
  </link>
  <joint name="rotor_3_joint" type="continuous">
    <origin rpy="0 0 0" xyz="-0.24 -0.24 0.035"/>
    <child link="rotor_3"/>
    <parent link="base_link"/>
    <axis xyz="0 0 1"/>
    <gazebo>
      <physics>
        <ode>
          <implicit_spring_damper>1</implicit_spring_damper>
        </ode>
      </physics>
    </gazebo>
  </joint>
  <gazebo>
    <plugin filename="libLiftDragPlugin.so" name="rotor_3_blade_1">
      <a0>0.3</a0>
      <alpha_stall>1.4</alpha_stall>
      <cla>0.06</cla>
      <cda>0.10</cda>
      <cma>0.00</cma>
      <cla_stall>-0.025</cla_stall>
      <cda_stall>0.0</cda_stall>
      <cma_stall>0.0</cma_stall>
      <area>0.02345</area>
      <air_density>1.2041</air_density>
      <cp>0.084 0 0</cp>
      <forward>0 -1 0</forward>
      <upward>0 0 1</upward>
      <link_name>rotor_3</link_name>
    </plugin>
    <plugin filename="libLiftDragPlugin.so" name="rotor_3_blade_2">
      <a0>0.3</a0>
      <alpha_stall>1.4</alpha_stall>
      <cla>0.06</cla>
      <cda>0.10</cda>
      <cma>0.00</cma>
      <cla_stall>-0.025</cla_stall>
      <cda_stall>0.0</cda_stall>
      <cma_stall>0.0</cma_stall>
      <area>0.02345</area>
      <air_density>1.2041</air_density>
      <cp>-0.084 0 0</cp>
      <forward>0 1 0</forward>
      <upward>0 0 1</upward>
      <link_name>rotor_3</link_name>
    </plugin>
  </gazebo>
  <gazebo reference="base_link">
    <sensor name="imu_sensor" type="imu">
      <pose>0 0 0 3.141593 0 0</pose>
      <always_on>1</always_on>
      <update_rate>1000.0</update_rate>
    </sensor>
  </gazebo>
  <!-- Ardupilot position -->
  <gazebo>
    <plugin filename="libArduPilotPlugin.so" name="arducopter_plugin">
      <fdm_addr>127.0.0.1</fdm_addr>
      <fdm_port_in>9002</fdm_port_in>
      <fdm_port_out>9003</fdm_port_out>
      <!--
            Require by APM :
            Only change model and gazebo from XYZ to XY-Z coordinates
        -->
      <modelXYZToAirplaneXForwardZDown>0 0 0 3.141593 0 0</modelXYZToAirplaneXForwardZDown>
      <gazeboXYZToNED>0 0 0 3.141593 0 0</gazeboXYZToNED>
      <imuName>navi::base_link::imu_sensor</imuName>
      <connectionTimeoutMaxCount>5</connectionTimeoutMaxCount>
      <control channel="0">
        <!--
            incoming control command [0, 1]
            so offset it by 0 to get [0, 1]
            and divide max target by 1.
            offset = 0
            multiplier = 838 max rpm / 1 = 838
          -->
        <type>VELOCITY</type>
        <offset>0</offset>
        <p_gain>0.20</p_gain>
        <i_gain>0</i_gain>
        <d_gain>0</d_gain>
        <i_max>0</i_max>
        <i_min>0</i_min>
        <cmd_max>2.5</cmd_max>
        <cmd_min>-2.5</cmd_min>
        <jointName>rotor_0_joint</jointName>
        <multiplier>6340</multiplier>
        <controlVelocitySlowdownSim>1</controlVelocitySlowdownSim>
      </control>
      <control channel="1">
        <type>VELOCITY</type>
        <offset>0</offset>
        <p_gain>0.20</p_gain>
        <i_gain>0</i_gain>
        <d_gain>0</d_gain>
        <i_max>0</i_max>
        <i_min>0</i_min>
        <cmd_max>2.5</cmd_max>
        <cmd_min>-2.5</cmd_min>
        <jointName>rotor_1_joint</jointName>
        <multiplier>6340</multiplier>
        <controlVelocitySlowdownSim>1</controlVelocitySlowdownSim>
      </control>
      <control channel="2">
        <type>VELOCITY</type>
        <offset>0</offset>
        <p_gain>0.20</p_gain>
        <i_gain>0</i_gain>
        <d_gain>0</d_gain>
        <i_max>0</i_max>
        <i_min>0</i_min>
        <cmd_max>2.5</cmd_max>
        <cmd_min>-2.5</cmd_min>
        <jointName>rotor_2_joint</jointName>
        <multiplier>-6340</multiplier>
        <controlVelocitySlowdownSim>1</controlVelocitySlowdownSim>
      </control>
      <control channel="3">
        <type>VELOCITY</type>
        <offset>0</offset>
        <p_gain>0.20</p_gain>
        <i_gain>0</i_gain>
        <d_gain>0</d_gain>
        <i_max>0</i_max>
        <i_min>0</i_min>
        <cmd_max>2.5</cmd_max>
        <cmd_min>-2.5</cmd_min>
        <jointName>rotor_3_joint</jointName>
        <multiplier>-6340</multiplier>
        <controlVelocitySlowdownSim>1</controlVelocitySlowdownSim>
      </control>
    </plugin>    
  </gazebo>
    <!-- Gimbal position params -->
  <!-- Pan Bracket -->
  <link name="gimbal_pan">
    <inertial>
      <mass value="0.025"/>
      <inertia ixx="5.8083e-4" ixy="0" ixz="0" iyy="3.0833e-5" iyz="0" izz="5.9083e-4"/>
    </inertial>
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="meshes/gimbal_pan.dae" scale="1 1 1"/>
      </geometry>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="0.001 0.001 0.001"/>
      </geometry>
    </collision>
  </link>
  <gazebo reference="gimbal_pan">
    <material>Gazebo/DarkGrey</material>
  </gazebo>
  <joint name="base_to_pan" type="revolute">
    <origin rpy="0 0 0" xyz="0 0 0.015"/>
    <axis xyz="0 0 1"/>
    <parent link="base_link"/>
    <child link="gimbal_pan"/>
    <limit effort="10" lower="-1.57079632679" upper="1.57079632679" velocity="20"/>
  </joint>
  <!-- Roll Bracket -->
  <link name="gimbal_roll">
    <inertial>
      <mass value="0.025"/>
      <inertia ixx="5.8083e-4" ixy="0" ixz="0" iyy="3.0833e-5" iyz="0" izz="5.9083e-4"/>
    </inertial>
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="meshes/gimbal_roll.dae" scale="1 1 1"/>
      </geometry>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="0.001 0.001 0.001"/>
      </geometry>
    </collision>
  </link>
  <gazebo reference="gimbal_roll">
    <material>Gazebo/DarkGrey</material>
  </gazebo>
  <joint name="pan_to_roll" type="revolute">
    <origin rpy="0 0 0" xyz="0 0 0.075"/>
    <axis xyz="1 0 0"/>
    <parent link="gimbal_pan"/>
    <child link="gimbal_roll"/>
    <limit effort="10" lower="-0.785398163397" upper="0.785398163397" velocity="20"/>
  </joint>
  <!-- Tilt Bracket-->
  <link name="gimbal_tilt">
    <inertial>
      <mass value="0.025"/>
      <inertia ixx="5.8083e-4" ixy="0" ixz="0" iyy="3.0833e-5" iyz="0" izz="5.9083e-4"/>
    </inertial>
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="meshes/gimbal_tilt.dae" scale="1 1 1"/>
      </geometry>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="0.001 0.001 0.001"/>
      </geometry>
    </collision>
  </link>
  <gazebo reference="gimbal_tilt">
    <material>Gazebo/DarkGrey</material>
  </gazebo>
  <joint name="roll_to_tilt" type="revolute">
    <origin rpy="0 0 0" xyz="0.018 0 0"/>
    <axis xyz="0 1 0"/>
    <parent link="gimbal_roll"/>
    <child link="gimbal_tilt"/>
    <limit effort="10" lower="-0.785398163397" upper="0.785398163397" velocity="20"/>
  </joint>
  <link name="gimbal_camera">
    <inertial>
      <mass value="0.025"/>
      <inertia ixx="5.8083e-4" ixy="0" ixz="0" iyy="3.0833e-5" iyz="0" izz="5.9083e-4"/>
    </inertial>
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="0.001 0.001 0.001"/>
      </geometry>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="0.001 0.001 0.001"/>
      </geometry>
    </collision>
  </link>
  <gazebo reference="gimbal_base">
    <material>Gazebo/DarkGrey</material>
  </gazebo>
  <joint name="gimbal_camera_joint" type="fixed">
    <parent link="gimbal_tilt"/>
    <child link="gimbal_camera"/>
    <origin rpy="0 0 0" xyz="0 0.005 0"/>
  </joint>
  <!-- Gimbal Controller Plugin -->
  <gazebo>
    <plugin filename="libhm_gimbal.so" name="gimbal_controller">
      <gimbalName>gimbal</gimbalName>
      <topicName>/gimbal/joints</topicName>
      <pitch>roll_to_tilt</pitch>
      <roll>pan_to_roll</roll>
      <yaw>base_to_pan</yaw>
      <balance_target>gimbal_camera</balance_target>
      <!-- Position Based PID Parameters -->
      <kp0>20</kp0>
      <ki0>1.5</ki0>
      <kd0>0.8</kd0>
      <imax0>1.0</imax0>
      <imin0>-1.0</imin0>
      <driveMax0>20.0</driveMax0>
      <driveMin0>-20.0</driveMin0>
      <kp1>20</kp1>
      <ki1>1</ki1>
      <kd1>0.3</kd1>
      <imax1>1.0</imax1>
      <imin1>-1.0</imin1>
      <driveMax1>20.0</driveMax1>
      <driveMin1>-20.0</driveMin1>
      <kp2>20</kp2>
      <ki2>1.5</ki2>
      <kd2>0.8</kd2>
      <imax2>1</imax2>
      <imin2>-1</imin2>
      <driveMax2>20.0</driveMax2>
      <driveMin2>-20.0</driveMin2>
    </plugin>
  </gazebo>
  <!-- Camera sensor -->
  <gazebo reference="gimbal_camera">
    <sensor name="gimbal_camera" type="camera">
      <update_rate>10.0</update_rate>
      <camera name="gimbal">
        <horizontal_fov>1.287</horizontal_fov>
        <image>
          <width>300</width>
          <height>300</height>
          <format>B8G8R8</format>
        </image>
        <clip>
          <near>0.02</near>
          <far>300</far>
        </clip>
      </camera>
      <plugin filename="libhm_camera.so" name="camera_controller">
        <topicName>/gimbal/image_raw</topicName>
        <namespace>/h1</namespace>
      </plugin>
    </sensor>
  </gazebo>
  <link name="gimbal_flashlight">
    <visual>
      <origin rpy="0 0 -1.57" xyz="0.0 0.0 0"/>
      <geometry>
        <mesh filename="package://hm_sensor_description/meshes/spotlight.dae" scale="0.005 0.005 0.005"/>
      </geometry>
    </visual>
    <inertial>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <mass value="0.0001"/>
      <inertia ixx="0.001" ixy="0.0" ixz="0.0" iyy="0.001" iyz="0.0" izz="0.001"/>
    </inertial>
  </link>
  <joint name="gimbal_flashlight_joint" type="fixed">
    <parent link="gimbal_tilt"/>
    <child link="gimbal_flashlight"/>
    <origin rpy="0 0 0" xyz="-0.012 -0.025 -0.01"/>
  </joint>
  <gazebo reference="gimbal_flashlight">
    <light name="light_source" type="spot">
      <pose>0.03 -0.02 -0.01 0 -1.57 0</pose>
      <attenuation>
        <range>40</range>
        <linear>0</linear>
        <constant>0.02</constant>
        <quadratic>0.02</quadratic>
      </attenuation>
      <diffuse>220 210 175 1</diffuse>
      <specular>220 210 175 1</specular>
      <spot>
        <inner_angle>0.7</inner_angle>
        <outer_angle>1</outer_angle>
        <falloff>1</falloff>
      </spot>
      <cast_shadows>true</cast_shadows>
    </light>
  </gazebo>
  <!-- Attach hovermap to the subt body -->
  <link name="hovermap_base">
    <inertial>
      <mass value="0.7"/>
      <origin rpy="0 0 1.57079632679" xyz="0 0 0"/>
      <inertia ixx="0.000169166666667" ixy="0.0" ixz="0.0" iyy="9.57547169811e-06" iyz="0.0" izz="0.000291666666667"/>
    </inertial>
    <visual>
      <origin rpy="0 0 1.57079632679" xyz="0.0245 0 0.041"/>
      <geometry>
        <mesh filename="package://hm_sensor_description/meshes/ST-LIDAR-case-2.dae" scale="1 1 1"/>
      </geometry>
    </visual>
    <collision>
      <origin rpy="0 0 1.57079632679" xyz="0.0245 0 0.041"/>
      <geometry>
        <mesh filename="package://hm_sensor_description/meshes/ST-LIDAR-case-2.dae" scale="1 1 1"/>
      </geometry>
    </collision>
  </link>
  <joint name="duck_joint" type="fixed">
    <origin rpy="0 0 -1.57079632679" xyz="-0.0 -0.095 -0.0525"/>
    <parent link="body"/>
    <child link="hovermap_base"/>
  </joint>
  <!-- Encoder base added in other macro depending on horizontal or vertical -->
  <link name="encoder_rotating">
    <inertial>
      <mass value="0.1"/>
      <origin rpy="3.14159265359 0 0" xyz="0 0 0"/>
      <inertia ixx="6.66666666667e-06" ixy="0.0" ixz="0.0" iyy="6.66666666667e-06" iyz="0.0" izz="6.66666666667e-06"/>
    </inertial>
    <visual>
      <origin rpy="3.14159265359 0 1.57079632679" xyz="0 0 -0.0125"/>
      <geometry>
        <mesh filename="package://hm_sensor_description/meshes/ST-LIDAR-hipoly.dae" scale="1 1 1"/>
      </geometry>
    </visual>
    <collision>
      <origin rpy="3.14159265359 0 1.57079632679" xyz="0 0 -0.0125"/>
      <geometry>
        <mesh filename="package://hm_sensor_description/meshes/ST-LIDAR-hipoly.dae" scale="1 1 1"/>
      </geometry>
    </collision>
  </link>
  <!-- <joint name="encoder_joint" type="revolute"> -->
  <joint name="encoder_joint" type="continuous">
    <origin rpy="0 -1.0471975512 0" xyz="0 0 0"/>
    <parent link="encoder"/>
    <child link="encoder_rotating"/>
    <axis xyz="0 0 1"/>
    <!-- <limit effort="0" lower="0" upper="0" velocity="0"/> -->
    <limit effort="2.01" velocity="1.0"/>
  </joint>
  <link name="velodyne">
    <inertial>
      <mass value="0.001"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="1e-5" ixy="0.0" ixz="0.0" iyy="1e-5" iyz="0.0" izz="1e-5"/>
    </inertial>
    <!-- not displaying the visuals here
            <visual>
                <origin xyz="0 0 0" rpy="0 0 ${pi/2}" />
                <geometry>
                    <mesh
                        filename="package://hm_sensor_description/meshes/H LIDAR sensor.dae"
                        scale="1 1 1" />
                </geometry>
            </visual> -->
    <!-- using a mesh collider instead
            <collision>
                <origin xyz="0.001 0.007 0" rpy="${pi/2} 0 0" />
                <geometry>
                    <cylinder length="${height}" radius="${radius}" />
                </geometry>
            </collision>-->
  </link>
  <!-- Joint connecting the lidar sensor to its parent (the velodyne cylinder) -->
  <joint name="velodyne_joint" type="fixed">
    <origin rpy="0 1.57079632679 0" xyz="0.0 0.0 -0.09"/>
    <parent link="encoder_rotating"/>
    <child link="velodyne"/>
  </joint>
  <!-- The actual sensor is inside the link -->
  <!-- NOTE: The pose should be set to 0 / it has no effect if it isn't set to 0 -->
  <gazebo reference="velodyne">
    <sensor name="velodyne" type="gpu_ray">
      <always_on>true</always_on>
      <update_rate>20</update_rate>
      <pose>0 0 0 0 0 0</pose>
      <visualize>false</visualize>
      <ray>
        <scan>
          <horizontal>
            <samples>360</samples>
            <resolution>1</resolution>
            <min_angle>0.0</min_angle>
            <max_angle>6.28318530718</max_angle>
          </horizontal>
          <vertical>
            <samples>16</samples>
            <resolution>1</resolution>
            <min_angle>-0.261799387799</min_angle>
            <max_angle>0.261799387799</max_angle>
          </vertical>
        </scan>
        <range>
          <min>0.08</min>
          <max>100.0</max>
          <resolution>1</resolution>
        </range>
        <noise>
          <type>gaussian</type>
          <mean>0.0</mean>
          <stddev>0.01</stddev>
        </noise>
      </ray>
      <plugin filename="libhm_gpu_laser.so" name="hm_velodyne_controller">
        <modelName>navi</modelName>
        <encoderJoint>encoder_joint</encoderJoint>
        <topicName>/velodyne_points</topicName>
        <correction>0.0</correction>
      </plugin>
    </sensor>
  </gazebo>
  <gazebo>
    <plugin filename="libhm_joint_controller.so" name="encoder_joint_controller">
      <jointName>encoder_joint</jointName>
      <frameName>hovermap_base</frameName>
      <kp>0.001</kp>
      <!--reduced according the lidar mass -->
      <ki>0.0</ki>
      <kd>0.0</kd>
      <imax>1.0</imax>
      <imin>-1.0</imin>
      <driveMax>100.0</driveMax>
      <driveMin>-100.0</driveMin>
      <velocitySetpoint>3.14159265359</velocitySetpoint>
      <updateRate>100</updateRate>
    </plugin>
  </gazebo>
  <link name="imu">
    <inertial>
      <mass value="0.001"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="1.66666666667e-08" ixy="0.0" ixz="0.0" iyy="1.66666666667e-08" iyz="0.0" izz="1.66666666667e-08"/>
    </inertial>
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="0.01 0.01 0.01"/>
      </geometry>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="0.01 0.01 0.01"/>
      </geometry>
    </collision>
  </link>
  <joint name="imu_joint" type="fixed">
    <origin rpy="3.14159265359 0 0" xyz="0 0 0"/>
    <parent link="hovermap_base"/>
    <child link="imu"/>
  </joint>
  <gazebo reference="imu">
    <sensor name="imu" type="imu">
      <always_on>true</always_on>
      <update_rate>100</update_rate>
      <pose>0 0 0 0 0 0</pose>
      <visualize>true</visualize>
      <imu>
        <topic>imu</topic>
        <angular_velocity>
          <x>
            <noise type="none"/>
          </x>
          <y>
            <noise type="none"/>
          </y>
          <z>
            <noise type="none"/>
          </z>
        </angular_velocity>
        <linear_acceleration>
          <x>
            <noise type="none"/>
          </x>
          <y>
            <noise type="none"/>
          </y>
          <z>
            <noise type="none"/>
          </z>
        </linear_acceleration>
      </imu>
      <plugin filename="libhm_imu.so" name="hm_imu_controller">
        <topicName>imu</topicName>
        <frameName>imu</frameName>
        <noiseFree>true</noiseFree>
        <useROS>0</useROS>
      </plugin>
    </sensor>
  </gazebo>
  <!-- LEDs -->
  <!-- <xacro:led led_prefix="center" parent_link="${name}_base" ns="${model}" xyz="-0.10 0 0" rpy="0 ${-pi/2} 0" range="0.0" brightness="0.5" default_color='0 0.8 0' lightShape="box"/>
    <xacro:led led_prefix="left" parent_link="${name}_base" ns="${model}" xyz="-0.10 0.05 0" rpy="0 ${-pi/2} 0" range="0.015" brightness="0.2" default_color='0.7 0.7 0'/> -->
  <!-- <gazebo reference="hovermap_base">
      <material>Gazebo/DarkGrey</material>
    </gazebo> -->
  <!-- Battery - data from https://www.dji.com/au/matrice-200-series/info#specs using 2 x TB55 -->
  <gazebo>
    <plugin filename="libhm_battery.so" name="battery_controller">
      <actuatorTopic>/M210/command/motor_speed</actuatorTopic>
      <voltage>22.8</voltage>
      <noCapacityVoltage>18</noCapacityVoltage>
      <capacityJoules>1273896</capacityJoules>
      <!-- 2 x 176.93 Wh in Joules -->
      <constantLoadWatts>36</constantLoadWatts>
      <!-- Watts [velodyne + NUC - should be increased for other power sinks] -->
      <updateRate>100</updateRate>
    </plugin>
  </gazebo>
  <link name="encoder">
    <inertial>
      <mass value="0.01"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="1.66666666667e-07" ixy="0.0" ixz="0.0" iyy="1.66666666667e-07" iyz="0.0" izz="1.66666666667e-07"/>
    </inertial>
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="0.01 0.01 0.01"/>
      </geometry>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="0.01 0.01 0.01"/>
      </geometry>
    </collision>
  </link>
  <joint name="base_to_encoder" type="fixed">
    <origin rpy="0 0 0" xyz="0.0795 0 0.0"/>
    <parent link="hovermap_base"/>
    <child link="encoder"/>
  </joint>
  <!-- display a box at aircraft center position specified by the stfs for the subterra  -->
  <!-- <xacro:rect_prism name="aircraft_center" xlength="0.01" ywidth="0.01" zheight="0.01" mass="0.01" />

    <joint name="base_to_aircraft_center" type="fixed">
      <origin xyz="-0.075 0 0.10" rpy="0 0 0" />
      <parent link="${name}_base" />
      <child link="aircraft_center" />
    </joint> -->
  <gazebo>
    <plugin filename="libhm_ekf_output.so" name="tf_plugin">
      <hitlKinematicFrame>base_link</hitlKinematicFrame>
      <odomFrame>slam_wildcat</odomFrame>
      <odomChildFrame>imu</odomChildFrame>
      <odomRefFrame>hovermap_base</odomRefFrame>
      <cmdVelTopic>/cmd_vel</cmdVelTopic>
      <odomInTopic>/dji_bridge/odometry</odomInTopic>
      <useHITL>0</useHITL>
      <odomOutTopic>/odometry</odomOutTopic>
    </plugin>
  </gazebo>
</robot>
