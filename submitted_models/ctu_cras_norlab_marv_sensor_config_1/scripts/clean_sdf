#!/usr/bin/env bash
set -e

sed -i \
  -e '/<surface>/{:a;N;/<\/surface>/!ba};/<surface>\n\s*<contact>\n\s*<ode\/>\n\s*<\/contact>\n\s*<friction>\n\s*<ode\/>\n\s*<\/friction>\n\s*<\/surface>/d' \
  -e '/<pose>\(-\?0 \?\)\{6\}<\/pose>/d' \
  -e '/<scale>1 1 1<\/scale>/d' \
  -e '/<angular_velocity\/>/d' \
  -e '/<linear_acceleration\/>/d' \
  -e '/<velocity_decay\/>/d' \
  -e '/<gravity>1<\/gravity>/d' \
  -e '/<kinematic>0<\/kinematic>/d' \
  -e '/<static>0<\/static>/d' "$1"
sed -i '/<contact>/{:a;N;/<\/contact>/!ba};/<contact>\n\s*<ode\/>\n\s*<\/contact>/d' "$1"
sed -i 's/\(<sdf version[^>]*>\)/\1\r  <!-- CAUTION: This is an autogenerated file, DO NOT EDIT IT!\r  It was generated by script update_robot_sdf_ign and is based on urdf\/marv.xacro source file.\r  Do all modifications there and then run the update script to regenerate the SDF. -->/g' "$1"